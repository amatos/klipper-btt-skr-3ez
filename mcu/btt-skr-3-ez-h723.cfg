# WARNING. DO NOT EDIT THIS FILE.
# To override settings from this file, you can copy and paste the relevant
# sections into your printer.cfg and change it there.

# This file contains common pin mappings for the BigTreeTech SKR 3.
# To use this config, the firmware should be compiled for the
# STM32H743 with a "128KiB bootloader".
# See docs/Config_Reference.md for a description of parameters.

[heater_bed]
heater_pin: heater_bed_heating_pin
sensor_type: EPCOS 100K B57560G104F
sensor_pin: heater_bed_sensor_pin
control: pid
pid_kp: 51.602
pid_ki: 0.620
pid_kd: 1073.966
min_temp: 0
max_temp: 125

[bed_screws]
screw1: 13,6
screw1_name: Front Left
screw2: 13,115
screw2_name: Front Center
screw3: 13,210
screw3_name: Front Right
screw4: 123,6
screw4_name: Center Left
screw5: 123,210
screw5_name: Center Right
screw6: 228,6
screw6_name: Back Left
screw7: 228,115
screw7_name: Back Center
screw8: 228,210
screw8_name: Back Right

[fan]
pin: fan_toolhead_cooling_pin
kick_start_time: 0.100
cycle_time: 0.010

[heater_fan nozzle_cooling_fan]
pin: fan_part_cooling_pin
max_power: 1.0
kick_start_time: 0.100
heater: extruder
heater_temp: 50.0

#[heater_fan fan2]
#pin: PB5

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 80

# MCU temperature sensor
[temperature_sensor SKR_3]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_btt-skr-3-ez-h723-if00

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_accel_to_decel: 2000
max_z_velocity: 20
max_z_accel: 300
square_corner_velocity: 5.0

[bed_mesh]
algorithm: bicubic
fade_start: 0.6
fade_end: 10
faulty_region_1_min: 100.583, 187.376
faulty_region_1_max: 122.083, 229.376
faulty_region_2_min: 125.672, -18.124
faulty_region_2_max: 147.172, 23.876
faulty_region_3_min: 192.261, 5.126
faulty_region_3_max: 234.261, 26.626
faulty_region_4_min: 114.422, 39.876
faulty_region_4_max: 135.922, 81.876
faulty_region_5_min: 21.422, 87.126
faulty_region_5_max: 42.922, 129.126
faulty_region_6_min: 54.172, 97.376
faulty_region_6_max: 96.172, 118.876
faulty_region_7_min: 154.172, 97.376
faulty_region_7_max: 196.172, 118.876
faulty_region_8_min: 205.136, 87.126
faulty_region_8_max: 226.636, 129.126
faulty_region_9_min: 114.422, 134.376
faulty_region_9_max: 135.922, 176.376
faulty_region_10_min: 176.177, 191.394
faulty_region_10_max: 218.177, 212.894
horizontal_move_z: 2
mesh_max: 228,210
mesh_min: 24, 6
mesh_pps: 3
probe_count: 5, 5
speed: 200

[screws_tilt_adjust]
screw1: 101, 100
screw1_name: Central Screw
screw2: 13, 13.4
screw2_name: Front left screw
screw3: 101, 13.4
screw3_name: Front Central Screw
screw4: 221, 13.4
screw4_name: Front right Screw
screw5: 221, 100
screw5_name: Central right Screw
screw6: 13, 101
screw6_name: Central left Screw
screw7: 13, 205.4
screw7_name: Rear left Screw
screw8: 101, 205.4
screw8_name: Rear central Screw
screw9: 221, 205.4
screw9_name: Rear right Screw
horizontal_move_z: 10
speed: 100
screw_thread: CCW-M3

[safe_z_home]
home_xy_position: 153,132
speed: 50.0
z_hop: 15
z_hop_speed: 15.0
move_to_previous: False

# BTT Filament smart sensor
[filament_motion_sensor filament_smart_sensor]
detection_length: 10
extruder: extruder
switch_pin: ^filament_sensor_pin
pause_on_runout: True
insert_gcode:
    M117 Insert Detected
runout_gcode:
    M117 Runout Detected
    #LCDRGB R=1 G=0 B=0  # Turn LCD red
    #BEEP I=12

[gcode_arcs]
resolution: 0.25

[board_pins btt_skr_3_ez_h723_tmc2209]
aliases:
  # steppers
  x_step_pin=PD4,   x_dir_pin=PD3,   x_enable_pin=PD6,   x_uart_pin=PD5,   x_diag_pin=PC1,   x_endstop_pin=PC1,
  y_step_pin=PA15,   y_dir_pin=PA8,   y_enable_pin=PD1,   y_uart_pin=PD0,   y_diag_pin=PC3,   y_endstop_pin=PC3,
  z0_step_pin=PE2,  z0_dir_pin=PE3,  z0_enable_pin=PE0,  z0_uart_pin=PE1,  z0_diag_pin=PC0,
  z1_step_pin=null,  z1_dir_pin=null,  z1_enable_pin=null,  z1_uart_pin=null,  z1_diag_pin=null,
  z2_step_pin=null,  z2_dir_pin=null,  z2_enable_pin=null,  z2_uart_pin=null,  z2_diag_pin=null,
  e_step_pin=PD11,   e_dir_pin=PD10,   e_enable_pin=PD13,   e_uart_pin=PD12,   e_diag_pin=PA0,   e_heater_pin=PB3,  e_sensor_pin=PA2,
  # accel
  adxl345_cs_pin=PB12, adxl345_sclk=PB13, adxl345_mosi=PB15, adxl345_miso=PB14,
  # auto leveling
  bltouch_sensor_pin=PC13,  bltouch_control_pin=PE5,
  probe_pin=PC13,
  # fans
  fan_part_cooling_pin=PB7,
  fan_toolhead_cooling_pin=PB6,
  fan_controller_board_pin=PB5,
  # Bed heater
  heater_bed_heating_pin=PD7,
  heater_bed_sensor_pin=PA1,
  # Filament sensor
  filament_sensor_pin=PC2,

  ## Expansion ports
  # EXP1 header
  EXP1_1=PC5, EXP1_3=PB1, EXP1_5=PE9, EXP1_7=PE11, EXP1_9=<GND>,
  EXP1_2=PB0, EXP1_4=PE8, EXP1_6=PE10, EXP1_8=PE12, EXP1_10=<5V>,
  # EXP2 header
  EXP2_1=PA6, EXP2_3=PE7, EXP2_5=PB2, EXP2_7=PC4,  EXP2_9=<GND>,
  EXP2_2=PA5, EXP2_4=PA4, EXP2_6=PA7, EXP2_8=<RST>, EXP2_10=<NC>,
  # Pins EXP2_1, EXP2_6, EXP2_2 are also MISO, MOSI, SCK of bus "spi2"

[adxl345]
spi_bus: spi2 # Wifi slot SPI pins.
cs_pin: adxl345_cs_pin

# Tools
[skew_correction]

[input_shaper]

[virtual_sdcard]
path: ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move: True
